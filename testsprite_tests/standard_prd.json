{
  "meta": {
    "project": "Muscat Bay Operations Dashboard",
    "date": "2026-02-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "A centralized operations dashboard for Muscat Bay that consolidates STP, water, electricity, assets and contractor data into interactive visualizations, searchable registers, and exportable reports. The app provides role-aware navigation, charts, and server-backed tables powered by Supabase with demo fallbacks.",
  "core_goals": [
    "Provide a single-pane view of utility and operations KPIs (water, electricity, STP) for daily decision-making",
    "Enable searchable, filterable registers for assets and contractors with server-side pagination and CSV export",
    "Surface anomalies and loss detection for water systems and provide drill-down hierarchy and daily reports",
    "Offer consistent, responsive navigation and authentication with graceful fallback to demo mode when Supabase is not connected",
    "Support operational workflows (daily logs, meter lookups, contract renewals) with performant charts and exportable data"
  ],
  "features": [
    {
      "name": "Sidebar Navigation",
      "description": "Persistent application navigation allowing users to move between Dashboard, Water, Electricity, STP, Contractors, Assets, Pest Control, Fire Safety, Settings and Sign Out. Collapsible on desktop and overlay on mobile with active-state highlighting and tooltips on collapse.",
      "user_flows": [
        "Navigate to / -> See persistent sidebar with navigation items -> Click sidebar navigation item 'Water' -> See navigation to /water -> See 'Water' item highlighted with teal accent",
        "Navigate to / -> Click collapse/expand button to toggle sidebar width -> Hover over collapsed sidebar item -> See tooltip label for hovered item",
        "Open mobile browser -> Navigate to / -> Tap hamburger icon -> See sidebar overlay open -> Tap 'Assets' in overlay -> See navigation to /assets",
        "Navigate to / -> Click Sign Out button -> See navigation to /login",
        "Navigate to / -> Click sidebar navigation item 'Assets' -> See Demo Mode badge when Supabase is not connected"
      ]
    },
    {
      "name": "Water Dashboard",
      "description": "Comprehensive water management: monthly dashboards, water hierarchy, daily reports, zone and type filtering, searchable/paginated meter table, network hierarchy, loss gauges, and CSV upload for meter data.",
      "user_flows": [
        "Navigate to /water -> Switch to Monthly Dashboard tab -> Within Monthly Dashboard switch to Overview sub-tab -> Use date range slider to select 3M preset -> Select a zone from zone dropdown filter -> Click Residential Villa type filter pill -> See area and bar charts update for selected filters",
        "Navigate to /water -> Switch to Monthly Dashboard tab -> Click inside meter search field -> Search meters by name -> Click meter table column header to sort -> Navigate paginated meter table to page 2 -> See table update with sorted and paginated results",
        "Navigate to /water -> Switch to Water Hierarchy tab -> Expand root node in network hierarchy -> Expand child node -> See individual L4 meters listed -> Click a meter to open detail (in-table or modal)",
        "Navigate to /water -> Switch to Daily Report tab -> Wait for daily report data to load -> See daily consumption and loss analysis charts",
        "Navigate to /water -> Click CSV Upload button -> Select invalid/non-CSV file -> See file validation error message",
        "Navigate to /water -> Click CSV Upload button -> Upload CSV with missing required columns -> See upload validation failure and error details"
      ]
    },
    {
      "name": "Electricity Dashboard",
      "description": "Electricity monitoring with monthly trends, analysis by meter type, cost analysis, top consumers chart and a searchable, paginated meter database.",
      "user_flows": [
        "Navigate to /electricity -> Switch to Analysis by Type tab -> Click year filter button '2025' -> Select start and end months for date range -> Select a meter type in Analysis tab -> See monthly consumption area chart and top 10 consumers bar chart update",
        "Navigate to /electricity -> Switch to Database tab -> Click inside search field -> Search meters by name -> Sort database table column by clicking header -> Navigate paginated database table to next page -> See filtered, sorted, paginated results",
        "Navigate to /electricity -> Click Reset Filters button -> See all filters cleared and charts reset to 'All' data",
        "Navigate to /electricity -> Select a year with no data -> See empty state message and no-chart placeholder"
      ]
    },
    {
      "name": "STP Operations Dashboard",
      "description": "Sewage Treatment Plant operations: inlet vs TSE volumes, tanker operations, economic impact (income/savings), treatment efficiency badges, and a sortable/paginated daily operations log.",
      "user_flows": [
        "Navigate to /stp -> Switch to Dashboard tab -> Click year filter button 'All' -> Select start and end months -> See water treatment volumes area chart (Inlet vs TSE) and economic impact bar chart render",
        "Navigate to /stp -> Switch to Details Data tab -> Select a month from dropdown for daily operations log -> Click daily log table column header 'Efficiency' to sort -> Navigate paginated daily log table -> See color-coded efficiency badges (green/yellow/red) beside each row",
        "Navigate to /stp -> Select a month with no operations data -> See empty table state with guidance to select a different month or upload data",
        "Navigate to /stp -> Switch to Dashboard tab -> Network error prevents fetching STP data -> See Demo Mode badge or error notification explaining offline/demo fallback"
      ]
    },
    {
      "name": "Assets Register",
      "description": "Asset inventory with searchable, filterable, server-paginated table showing asset details and status badges, plus summary stats for counts and total value.",
      "user_flows": [
        "Navigate to /assets -> Click inside search field -> Search assets by name -> Select status filter 'Under Maintenance' -> See asset table filter to matching results and status badges highlighted",
        "Navigate to /assets -> Click table column header 'Last Service' to sort -> Navigate paginated table to page 3 -> See rows update for chosen page and sort order",
        "Navigate to /assets -> View stats cards -> See total assets, total value, active count and maintenance count displayed",
        "Navigate to /assets -> Type search term then immediately clear -> Wait 500ms debounce -> See table refresh to show unfiltered results",
        "Navigate to /assets -> Server-side pagination fails or Supabase unavailable -> See Demo Mode badge and an empty or partial asset table"
      ]
    },
    {
      "name": "Contractor Registry",
      "description": "Contractor management with search, status and contract type filters, financial summaries, and CSV export of filtered datasets.",
      "user_flows": [
        "Navigate to /contractors -> Click inside search field -> Search contractors by name -> Select status dropdown 'Active' -> Select contract type 'PO' -> See contractor table filtered and status/type badges displayed",
        "Navigate to /contractors -> Click Export CSV button -> Confirm export -> Download CSV file containing currently filtered contractor rows",
        "Navigate to /contractors -> View stats cards -> See total contractors, active count, expired count and annual value displayed",
        "Navigate to /contractors -> Apply filters that return zero rows -> Click Export CSV button -> See 'No data to export' feedback and prevent download",
        "Navigate to /contractors -> Supabase fetch fails -> See Demo Mode badge and fallback sample data in table"
      ]
    },
    {
      "name": "Authentication (Login / Signup / Forgot Password)",
      "description": "User authentication flows for sign-in, registration and password reset with Supabase-backed auth and graceful fallback to demo messaging when backend is unavailable.",
      "user_flows": [
        "Navigate to /login -> Fill email field -> Fill password field -> Click Login button -> See redirect to / (dashboard) on successful auth",
        "Navigate to /login -> Fill email field with incorrect password -> Click Login button -> See authentication error message and stay on /login",
        "Navigate to /signup -> Fill required registration fields -> Click Sign Up button -> See account created confirmation and redirect to /login",
        "Navigate to /forgot-password -> Fill email field -> Click Request Reset button -> See confirmation that reset email was sent or demo fallback message if Supabase not connected"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript",
      "Next.js 16",
      "React 19",
      "Tailwind CSS 4",
      "Recharts 3",
      "Supabase (auth + database)",
      "Radix UI / shadcn components",
      "Lucide React icons"
    ],
    "routes": [
      {
        "path": "/",
        "file": "app/app/page.tsx",
        "auth_required": true,
        "description": "Main dashboard with overview stats, water production chart, STP treatment chart, and recent activity feed"
      },
      {
        "path": "/water",
        "file": "app/app/water/page.tsx",
        "auth_required": true,
        "description": "Water management page with monthly dashboard, water hierarchy view, and daily report tabs"
      },
      {
        "path": "/electricity",
        "file": "app/app/electricity/page.tsx",
        "auth_required": true,
        "description": "Electricity monitoring with consumption trends, analysis by type, and meter database"
      },
      {
        "path": "/stp",
        "file": "app/app/stp/page.tsx",
        "auth_required": true,
        "description": "STP (Sewage Treatment Plant) operations dashboard with treatment volumes, economic impact, and daily operations log"
      },
      {
        "path": "/assets",
        "file": "app/app/assets/page.tsx",
        "auth_required": true,
        "description": "Asset register with searchable, filterable, paginated table of equipment and infrastructure"
      },
      {
        "path": "/contractors",
        "file": "app/app/contractors/page.tsx",
        "auth_required": true,
        "description": "Contractor registry with search, status/type filters, and CSV export"
      },
      {
        "path": "/pest-control",
        "file": "app/app/pest-control/page.tsx",
        "auth_required": true,
        "description": "Pest control management page"
      },
      {
        "path": "/firefighting",
        "file": "app/app/firefighting/quotes/page.tsx",
        "auth_required": true,
        "description": "Fire safety and firefighting quotes page"
      },
      {
        "path": "/settings",
        "file": "app/app/settings/page.tsx",
        "auth_required": true,
        "description": "Application settings page"
      },
      {
        "path": "/login",
        "file": "app/app/login/layout.tsx",
        "auth_required": false,
        "description": "User login page"
      },
      {
        "path": "/signup",
        "file": "app/app/signup/layout.tsx",
        "auth_required": false,
        "description": "User registration page"
      },
      {
        "path": "/forgot-password",
        "file": "app/app/forgot-password/page.tsx",
        "auth_required": false,
        "description": "Password reset request page"
      }
    ],
    "features": [
      {
        "name": "Sidebar Navigation",
        "description": "Persistent sidebar with links to all pages - Dashboard, Water, Electricity, STP Plant, Contractors, Assets, Pest Control, Fire Safety, Settings, and Sign Out. Sidebar can be collapsed/expanded on desktop and opens as overlay on mobile.",
        "files": [
          "app/components/layout/sidebar.tsx",
          "app/components/layout/sidebar-context.tsx",
          "app/components/layout/client-layout.tsx",
          "app/components/layout/navbar.tsx"
        ],
        "entry_route": "/",
        "user_interactions": [
          "Click sidebar navigation items to navigate between pages",
          "Click collapse/expand button to toggle sidebar width",
          "Active page is highlighted with teal accent and glow effect",
          "Hover over collapsed sidebar items to see tooltip labels",
          "Click Sign Out button to log out",
          "On mobile tap hamburger to open sidebar overlay"
        ],
        "api_calls": [],
        "auth_required": true
      },
      {
        "name": "Water Dashboard",
        "description": "Comprehensive water management with monthly stats (A1 source, A2 zone distribution, A3 individual), system efficiency, water loss analysis, zone consumption, consumption by meter type, searchable meter table, and network hierarchy view",
        "files": [
          "app/app/water/page.tsx",
          "app/components/water/zone-tabs.tsx",
          "app/components/water/type-filter-pills.tsx",
          "app/components/water/meter-table.tsx",
          "app/components/water/water-loss-gauge.tsx",
          "app/components/water/circular-gauge.tsx",
          "app/components/water/network-hierarchy.tsx",
          "app/components/water/anomaly-alerts.tsx",
          "app/components/water/CSVUploadDialog.tsx",
          "app/components/charts/liquid-area-chart.tsx",
          "app/components/charts/liquid-bar-chart.tsx",
          "app/components/charts/liquid-progress-ring.tsx"
        ],
        "entry_route": "/water",
        "user_interactions": [
          "Switch between Monthly Dashboard, Water Hierarchy, and Daily Report tabs",
          "Within Monthly Dashboard switch between Overview, Zone Analysis, Consumption by Type, and Main Database sub-tabs",
          "Use date range slider to filter by month range with quick presets (3M, 6M, YTD, Reset)",
          "Select specific zones from zone dropdown filter",
          "Click type filter pills to filter by meter type (Residential Villa, Apartment, Bulk, IRR, etc.)",
          "Search meters by name in the meter table",
          "Sort meter table columns by clicking headers",
          "Navigate paginated meter table (10 items per page)",
          "Expand/collapse nodes in the network hierarchy tree view",
          "View area charts for water distribution and loss analysis",
          "View bar charts for consumption by type",
          "View circular gauge progress rings for zone metrics"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "Supabase RPC getWaterMetersFromSupabase"
          },
          {
            "method": "GET",
            "endpoint": "Supabase RPC getWaterLossDailyFromSupabase"
          },
          {
            "method": "GET",
            "endpoint": "Supabase RPC getDailyWaterConsumptionFromSupabase"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Electricity Dashboard",
        "description": "Electricity consumption monitoring with monthly trends, cost analysis, consumption by meter type, top 10 consumers chart, and full meter database with search and pagination",
        "files": [
          "app/app/electricity/page.tsx",
          "app/entities/electricity.ts",
          "app/functions/api/electricity.ts"
        ],
        "entry_route": "/electricity",
        "user_interactions": [
          "Switch between Overview, Analysis by Type, and Database tabs",
          "Click year filter buttons (All, 2024, 2025, 2026)",
          "Select start and end months for date range filtering",
          "Select meter type in Analysis tab to see filtered data",
          "View monthly consumption area chart",
          "View consumption by type bar chart",
          "View top 10 consumers bar chart in Analysis tab",
          "Search meters by name, account, or type in Database tab",
          "Sort database table columns by clicking headers",
          "Navigate paginated database table (15 items per page)",
          "Click Reset Filters button to clear all filters"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "Supabase RPC getElectricityMetersFromSupabase"
          }
        ],
        "auth_required": true
      },
      {
        "name": "STP Operations Dashboard",
        "description": "Sewage Treatment Plant monitoring with inlet/TSE volumes, tanker operations, economic impact tracking, treatment efficiency, and daily operations log with sorting and pagination",
        "files": [
          "app/app/stp/page.tsx",
          "app/hooks/useSTPData.ts",
          "app/entities/stp.ts",
          "app/functions/api/stp.ts"
        ],
        "entry_route": "/stp",
        "user_interactions": [
          "Switch between Dashboard and Details Data tabs",
          "Click year filter buttons (All, 2024, 2025, 2026)",
          "Select start and end months for date range",
          "View water treatment volumes area chart (Inlet vs TSE)",
          "View economic impact bar chart (Income vs Savings)",
          "View tanker operations line chart",
          "Select month from dropdown for daily operations log",
          "Sort daily log table columns (Date, Inlet, TSE, Efficiency, Tanker Trips, Income, Savings, Total)",
          "Navigate paginated daily log table (15 rows per page)",
          "See color-coded efficiency badges (green >=95%, yellow >=90%, red <90%)"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "Supabase RPC getSTPOperationsFromSupabase"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Assets Register",
        "description": "Equipment and infrastructure asset inventory with searchable and filterable table, status tracking, and pagination",
        "files": [
          "app/app/assets/page.tsx",
          "app/actions/assets.ts",
          "app/entities/asset.ts",
          "app/functions/api/assets.ts"
        ],
        "entry_route": "/assets",
        "user_interactions": [
          "Search assets by name, location, or serial number",
          "Filter by status (All, Active, Under Maintenance, In Storage)",
          "View asset table with columns for name, serial number, category, location, status, last service, value",
          "See color-coded status badges (green=Active, orange=Maintenance, red=Decommissioned, gray=Storage)",
          "Navigate paginated table (25 items per page)",
          "View stats cards showing total assets, total value, active count, and maintenance count"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "Supabase fetchAssetsAction server action"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Contractor Registry",
        "description": "Contractor management with search, status and contract type filtering, financial tracking, and CSV export capability",
        "files": [
          "app/app/contractors/page.tsx",
          "app/entities/contractor.ts",
          "app/functions/api/contractors.ts",
          "app/lib/export-utils.ts"
        ],
        "entry_route": "/contractors",
        "user_interactions": [
          "Search contractors by name, service, or notes",
          "Filter by status dropdown (All, Active, Expired, Retain)",
          "Filter by contract type dropdown (All, Contract, PO, Quotation)",
          "View contractor table with name, service, status, contract type, dates, monthly/annual values, renewal plan, notes",
          "See color-coded status badges and contract type badges",
          "Click Export CSV button to download filtered data",
          "View stats cards showing total contractors, active count, expired count, and annual value"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "Supabase getContractorTrackerData"
          }
        ],
        "auth_required": true
      }
    ],
    "known_limitations": [
      {
        "issue": "App requires Supabase connection for live data; falls back to demo/mock data when not configured",
        "location": "app/lib/supabase.ts",
        "impact": "Tests may see Demo Mode badge instead of Live Data when Supabase is not connected"
      },
      {
        "issue": "Water page Daily Report tab has separate data loading that may take additional time",
        "location": "app/app/water/page.tsx",
        "impact": "Daily report data may load independently from monthly dashboard data"
      },
      {
        "issue": "Assets page uses server actions for data fetching with server-side pagination",
        "location": "app/actions/assets.ts",
        "impact": "Search is debounced at 500ms, pagination happens server-side"
      }
    ]
  }
}
