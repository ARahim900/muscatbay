{
  "meta": {
    "project": "Muscat Bay Management System - Dashboard",
    "date": "2026-02-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "The Dashboard provides a single-pane overview of facility operations (water, electricity, STP, contractors, and assets) with KPI cards, trend charts and a filterable recent activity feed. It uses useDashboardData to prefer live Supabase data and fall back to demo data when necessary.",
  "core_goals": [
    "Surface high-level operational KPIs for Water, Electricity, STP, Contractors and Assets at a glance",
    "Provide interactive charts for recent trends (water production and STP treatment) with tooltips and responsive layout",
    "Expose an actionable recent activity feed with category filters to surface critical alerts",
    "Gracefully handle data availability by indicating Live vs Demo mode and providing retry/error states",
    "Ensure responsive layout and accessible visual indicators (trend arrows, badges, legends)"
  ],
  "features": [
    {
      "name": "Dashboard Page Load & Data Status",
      "description": "Load the main operations dashboard, show loading and data status (Live Data vs Demo Mode), and surface the top-level page header.",
      "user_flows": [
        "Navigate to / -> See loading spinner while useDashboardData fetches -> useDashboardData aggregates live sources from Supabase -> See Data Status Badge show \"Live Data\" -> See page header Title \"Dashboard\" and description",
        "Navigate to / -> See loading spinner while useDashboardData attempts to fetch -> Supabase fetch fails -> useDashboardData falls back to mock data -> See Data Status Badge show \"Demo Mode\" -> See page header Title \"Dashboard\" and demo data displayed"
      ]
    },
    {
      "name": "Stats Grid (KPI Cards)",
      "description": "Display seven KPI cards (Water Production, Electricity Usage, STP Inlet Flow, TSE Output, STP Economic Impact, Active Contractors, Total Assets) with trend indicators comparing to previous month and hover interactivity.",
      "user_flows": [
        "Navigate to / -> View stats grid -> See 7 stat cards displayed (Water, Electricity, STP Inlet, TSE, STP Economic Impact, Active Contractors, Total Assets) -> Hover over a stat card -> See subtle hover background change -> See trend arrow and percentage comparing to previous month",
        "Navigate to / -> View stats grid -> One or more stat cards show placeholder or \"N/A\" due to partial data -> See legend or tooltip indicating missing data -> Click Retry button in page error state to re-trigger data fetch -> See stat cards populate"
      ]
    },
    {
      "name": "Water Production Trend Chart",
      "description": "Render an area chart showing the last 8 months of water production with gradient fill, interactive tooltips and responsive resizing.",
      "user_flows": [
        "Navigate to / -> View water production trend area chart in charts section -> Hover over a data point on the area chart -> See interactive tooltip with exact month and water volume value -> Resize viewport (or change device) -> See chart responsively resize",
        "Navigate to / -> View water production trend area chart -> Chart displays \"No data\" or empty state due to failed fetch -> Click Retry button in page error state -> See chart populate with data (live or demo) and tooltip become available"
      ]
    },
    {
      "name": "STP Treatment Overview Chart",
      "description": "Render grouped bar chart comparing STP Inlet vs TSE Output for the last 8 months with tooltips and legend.",
      "user_flows": [
        "Navigate to / -> View STP treatment bar chart in charts section -> Hover over a bar group -> See tooltip showing Inlet and TSE Output values for that month -> See legend indicating color mapping for Inlet and TSE",
        "Navigate to / -> View STP treatment bar chart -> Chart shows empty placeholder because STP details are not available (embedded iframe used for details) -> Click Retry button in page error state -> See chart populate with available aggregated STP data"
      ]
    },
    {
      "name": "Recent Activity Feed & Filters",
      "description": "Filterable feed of operational alerts and logs with category buttons (All, Critical, Warning, Info) and color-coded items.",
      "user_flows": [
        "Navigate to / -> Scroll to Recent Activity section -> See filter buttons with \"All\" active by default -> See a list of activity items (title, timestamp, type icon) -> Click \"Critical\" filter -> See activity list update to show only critical items",
        "Navigate to / -> Scroll to Recent Activity section -> Data fetch fails or feed is empty -> See empty-state message or error message in the activity area -> Click Retry button in page error state -> See activity feed repopulate (live or demo items)"
      ]
    },
    {
      "name": "Error Handling and Retry",
      "description": "Provide clear error states when data fetches fail and a Retry action that re-invokes useDashboardData to attempt live fetch again or fall back to demo data.",
      "user_flows": [
        "Navigate to / -> See loading spinner while data fetch runs -> Data fetch fails -> See centered red error message and a Retry button -> Click Retry button -> See loading spinner -> Data fetch succeeds and dashboard renders",
        "Navigate to / -> See loading spinner while data fetch runs -> Data fetch fails repeatedly -> useDashboardData falls back to mock/demo data -> See Demo Mode badge and dashboard populated with demo items -> See a hint explaining demo fallback"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript",
      "Next.js 16 (App Router)",
      "React 19",
      "Supabase (Auth, Database, Storage)",
      "Tailwind CSS 4",
      "Recharts 3",
      "Radix UI / Base UI",
      "shadcn/ui components",
      "Vitest + Testing Library"
    ],
    "routes": [
      {
        "path": "/",
        "file": "app/page.tsx",
        "auth_required": true,
        "description": "Main operations dashboard with stats grid, water production chart, STP overview chart, and recent activity log"
      },
      {
        "path": "/login",
        "file": "app/login/page.tsx",
        "auth_required": false,
        "description": "User login page with email/password, rate limiting, forgot password link"
      },
      {
        "path": "/signup",
        "file": "app/signup/page.tsx",
        "auth_required": false,
        "description": "New user registration with password strength indicator and email confirmation"
      },
      {
        "path": "/signup/professional",
        "file": "app/signup/professional/page.tsx",
        "auth_required": false,
        "description": "Professional/contractor application form with company details and service category selection"
      },
      {
        "path": "/forgot-password",
        "file": "app/forgot-password/page.tsx",
        "auth_required": false,
        "description": "Password reset request page with email input"
      },
      {
        "path": "/auth/callback",
        "file": "app/auth/callback/page.tsx",
        "auth_required": false,
        "description": "OAuth callback handler for signup confirmation and password reset flows"
      },
      {
        "path": "/auth/reset-password",
        "file": "app/auth/reset-password/page.tsx",
        "auth_required": false,
        "description": "Set new password page after clicking reset link from email"
      },
      {
        "path": "/water",
        "file": "app/water/page.tsx",
        "auth_required": true,
        "description": "Water system analysis with Monthly Dashboard (overview, zone analysis, consumption by type, database), Water Hierarchy, and Daily Report views"
      },
      {
        "path": "/electricity",
        "file": "app/electricity/page.tsx",
        "auth_required": true,
        "description": "Electricity monitoring with Overview, Analysis by Type, and Database tabs showing consumption and costs"
      },
      {
        "path": "/stp",
        "file": "app/stp/page.tsx",
        "auth_required": true,
        "description": "Sewage Treatment Plant monitoring with Dashboard (treatment volumes, economics, tanker ops) and Details Data tabs"
      },
      {
        "path": "/firefighting",
        "file": "app/firefighting/page.tsx",
        "auth_required": true,
        "description": "Fire safety management with Dashboard, PPM Tracker, Equipment, Faults, Contacts, Contract, and Quotes tabs"
      },
      {
        "path": "/firefighting/quotes",
        "file": "app/firefighting/quotes/page.tsx",
        "auth_required": true,
        "description": "Fire safety vendor quotations with cost tracking and approval status"
      },
      {
        "path": "/contractors",
        "file": "app/contractors/page.tsx",
        "auth_required": true,
        "description": "Contractor tracker with search, status/type filtering, CSV export, and paginated registry table"
      },
      {
        "path": "/pest-control",
        "file": "app/pest-control/page.tsx",
        "auth_required": true,
        "description": "Pest control operations via embedded Airtable daily report database"
      },
      {
        "path": "/settings",
        "file": "app/settings/page.tsx",
        "auth_required": true,
        "description": "User settings with Profile (avatar, name, username, website), Account, and Notifications tabs"
      },
      {
        "path": "/assets",
        "file": "app/assets/page.tsx",
        "auth_required": true,
        "description": "Asset inventory with search, status filtering, server-side pagination, and value tracking"
      }
    ],
    "features": [
      {
        "name": "User Login",
        "description": "Login with email and password credentials with rate limiting (5 attempts/60s, 5-min lockout)",
        "files": [
          "app/login/page.tsx",
          "lib/auth.ts",
          "lib/validation.ts"
        ],
        "entry_route": "/login",
        "user_interactions": [
          "Fill email input field",
          "Fill password input field",
          "Toggle password visibility",
          "Click Sign In button to submit",
          "See error message on invalid credentials",
          "Click Forgot password link to navigate to /forgot-password",
          "Click Create an account link to navigate to /signup"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "supabase.auth.signInWithPassword"
          }
        ],
        "auth_required": false
      },
      {
        "name": "User Registration",
        "description": "New user signup with full name, email, password strength validation, and email confirmation",
        "files": [
          "app/signup/page.tsx",
          "lib/auth.ts",
          "lib/validation.ts"
        ],
        "entry_route": "/signup",
        "user_interactions": [
          "Fill full name input",
          "Fill email input",
          "Fill password with strength indicator feedback (8+ chars, uppercase, lowercase, number, special)",
          "Fill confirm password field",
          "Click Create Account button",
          "See success state with email confirmation message",
          "Click link to professional application"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "supabase.auth.signUp"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Professional Application",
        "description": "Contractor/service provider registration with company details and service category",
        "files": [
          "app/signup/professional/page.tsx"
        ],
        "entry_route": "/signup/professional",
        "user_interactions": [
          "Fill company name",
          "Fill contact person name",
          "Fill email address",
          "Fill phone number",
          "Select service category from dropdown (13 categories)",
          "Fill business registration number (optional)",
          "Fill services description (min 20 chars, max 1000)",
          "Click Submit Application button",
          "See success confirmation"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "supabase.from('professional_applications').insert"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Password Reset Flow",
        "description": "Forgot password request and new password setting via email link",
        "files": [
          "app/forgot-password/page.tsx",
          "app/auth/reset-password/page.tsx",
          "app/auth/callback/page.tsx",
          "lib/auth.ts"
        ],
        "entry_route": "/forgot-password",
        "user_interactions": [
          "Fill email input on forgot password page",
          "Click Send Reset Link button",
          "See success message about email sent",
          "Click link in email (external)",
          "Fill new password on reset page",
          "Fill confirm password on reset page",
          "Click Reset Password button",
          "See success message and auto-redirect to login"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "supabase.auth.resetPasswordForEmail"
          },
          {
            "method": "POST",
            "endpoint": "supabase.auth.updateUser"
          }
        ],
        "auth_required": false
      },
      {
        "name": "Operations Dashboard",
        "description": "Main dashboard showing overview stats grid, water production trends, STP treatment chart, and recent activity log",
        "files": [
          "app/page.tsx",
          "hooks/useDashboardData.ts",
          "components/charts/"
        ],
        "entry_route": "/",
        "user_interactions": [
          "View stats grid (Water, Electricity, STP Inlet, TSE, Economic Impact, Contractors, Assets)",
          "View water production trend area chart",
          "View STP treatment bar chart",
          "Filter activity log by category (All, Critical, Warning, Info)",
          "See live/demo data indicator"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "useDashboardData hook (aggregates from multiple sources)"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Water System Analysis",
        "description": "Comprehensive water consumption monitoring with monthly dashboard (4 sub-tabs), water hierarchy, and daily report",
        "files": [
          "app/water/page.tsx",
          "lib/water-data.ts",
          "lib/water-daily-hierarchy.ts",
          "lib/water-network-data.ts",
          "components/water/"
        ],
        "entry_route": "/water",
        "user_interactions": [
          "Switch between Monthly Dashboard, Water Hierarchy, Daily Report views",
          "Select date range (start/end months) from dropdowns",
          "Reset date range",
          "Switch sub-tabs in Monthly Dashboard (Overview, Zone Analysis, Consumption by Type, Database)",
          "Select zone in Zone Analysis tab",
          "Filter by meter type in Consumption by Type tab",
          "Search meters in Database tab",
          "Sort table columns",
          "Navigate pagination",
          "View A1/A2/A3 values and loss metrics"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "getWaterMetersFromSupabase()"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Electricity Monitoring",
        "description": "Power consumption tracking with year/month filtering, type analysis, and meter database",
        "files": [
          "app/electricity/page.tsx"
        ],
        "entry_route": "/electricity",
        "user_interactions": [
          "Switch between Overview, Analysis by Type, Database tabs",
          "Select year filter buttons (All, 2024, 2025)",
          "Select month range",
          "Filter by type pills (Building, Residential, etc.)",
          "Use date range slider",
          "Search meter by name/account/type",
          "Sort table columns",
          "Navigate pagination",
          "View consumption and cost stats"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "getElectricityMetersFromSupabase()"
          }
        ],
        "auth_required": true
      },
      {
        "name": "STP Monitoring",
        "description": "Sewage treatment plant monitoring with treatment volumes, economic impact, tanker operations, and daily logs",
        "files": [
          "app/stp/page.tsx",
          "hooks/useSTPData.ts"
        ],
        "entry_route": "/stp",
        "user_interactions": [
          "Switch between Dashboard and Details Data tabs",
          "Select year filter buttons",
          "Select month range",
          "Select month in daily operations dropdown",
          "Sort daily operations table columns",
          "Navigate pagination for daily log",
          "View treatment efficiency and economic impact stats"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "getSTPOperationsFromSupabase()"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Fire Safety Management",
        "description": "Fire safety with 7 management tabs covering equipment, PPM tracking, faults, contacts, and contracts",
        "files": [
          "app/firefighting/page.tsx",
          "app/firefighting/quotes/page.tsx"
        ],
        "entry_route": "/firefighting",
        "user_interactions": [
          "Navigate 7 tabs (Dashboard, PPM Tracker, Equipment, Faults, Contacts, Contract, Quotes)",
          "Expand/collapse PPM stage sections",
          "Filter PPM items by status (All/Done/Fault/No Access/Not Started)",
          "Search equipment by name/location/type",
          "View contact details with call/email actions",
          "Navigate to quotes sub-page",
          "View quotation details and costs"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "getFireSafetyEquipment()"
          },
          {
            "method": "GET",
            "endpoint": "getFireQuotations()"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Contractor Tracker",
        "description": "Service provider monitoring with filtering, search, and CSV export",
        "files": [
          "app/contractors/page.tsx"
        ],
        "entry_route": "/contractors",
        "user_interactions": [
          "Search contractors by name/service/note",
          "Filter by status dropdown (All/Active/Expired/Retained)",
          "Filter by contract type dropdown (Contract/PO/Quotation)",
          "Export filtered data as CSV",
          "Navigate pagination",
          "View contractor registry table"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "getContractorTrackerData()"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Asset Management",
        "description": "Asset inventory with server-side search, status filtering, and paginated registry",
        "files": [
          "app/assets/page.tsx",
          "actions/assets.ts"
        ],
        "entry_route": "/assets",
        "user_interactions": [
          "Search assets by name/location/serial number (debounced 500ms)",
          "Filter by status buttons (All/Active/Under Maintenance/In Storage)",
          "Navigate pagination (Previous/Next)",
          "View asset registry table with values"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "fetchAssetsAction (Server Action)"
          }
        ],
        "auth_required": true
      },
      {
        "name": "User Settings",
        "description": "Profile management with avatar upload, name/username editing, and notification preferences",
        "files": [
          "app/settings/page.tsx",
          "lib/auth.ts"
        ],
        "entry_route": "/settings",
        "user_interactions": [
          "Upload avatar image (max 2MB)",
          "Remove avatar",
          "Edit full name",
          "Edit username",
          "Edit website URL",
          "Switch between Profile, Account, Notifications tabs",
          "Toggle email alerts",
          "Toggle critical alarms",
          "Click Save Changes button"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "updateUserProfile()"
          },
          {
            "method": "POST",
            "endpoint": "uploadAvatar() to Supabase Storage"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Pest Control",
        "description": "Pest control daily reports via embedded Airtable database",
        "files": [
          "app/pest-control/page.tsx"
        ],
        "entry_route": "/pest-control",
        "user_interactions": [
          "View embedded Airtable daily report database"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "Embedded Airtable iframe"
          }
        ],
        "auth_required": true
      }
    ],
    "known_limitations": [
      {
        "issue": "Firefighting PPM data is hardcoded in component, not fetched from database",
        "location": "app/firefighting/page.tsx",
        "impact": "PPM tracker data cannot be updated dynamically"
      },
      {
        "issue": "Pest Control page is only an embedded Airtable iframe with no native functionality",
        "location": "app/pest-control/page.tsx",
        "impact": "No native data management or testing possible for pest control features"
      },
      {
        "issue": "Settings notification toggles are UI-only and not connected to backend",
        "location": "app/settings/page.tsx",
        "impact": "Notification preferences are not persisted or functional"
      },
      {
        "issue": "STP Details tab uses embedded Airtable iframe",
        "location": "app/stp/page.tsx",
        "impact": "External dependency for STP detailed operations data"
      },
      {
        "issue": "Assets stats may be calculated from current page only, not full database",
        "location": "app/assets/page.tsx",
        "impact": "Stats may not reflect total asset values accurately"
      },
      {
        "issue": "Professional application duplicate detection only checks by email",
        "location": "app/signup/professional/page.tsx",
        "impact": "Same company could submit multiple applications with different emails"
      }
    ]
  }
}
